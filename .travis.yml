dist: trusty
sudo: required
rvm:
  - 2.3.4
before_install:
- node -v
- npm version
install:
- nvm install 8
- npm install npm
- node -v
- npm install
- npm run deploy
- bundle install
- bundle exec jekyll build
env:
  global:
  - NOKOGIRI_USE_SYSTEM_LIBRARIES=true
  - JEKYLL_ENV=production
deploy:
  - provider: s3
    access_key_id: $AWSKEYID
    secret_access_key:
      secure: $AWSSECRET
    bucket: $AWSBUCKET
    skip_cleanup: true
    region: $AWSREGION
    local-dir: _site
    acl: public_read
    on:
      branch: $DEPLOYPRODBRANCH
  - provider: s3
    access_key_id: $AWSDEVKEYID
    secret_access_key: $AWSDEVSECRET
    bucket: $AWSDEVBUCKET
    skip_cleanup: true
    region: $AWSREGION
    local-dir: _site
    acl: public_read
    on:
      branch: $DEPLOYDEVBRANCH
